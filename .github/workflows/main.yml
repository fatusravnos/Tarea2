name: Java CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '11'
        
    - name: Debug - Show repository structure
      run: |
        echo "üìÅ ESTRUCTURA DEL PROYECTO:"
        echo "=========================="
        find . -type f -name "*.java" | sort
        echo ""
        echo "üìÑ CONTENIDO DE CADA ARCHIVO:"
        echo "============================="
        for file in *.java; do
          echo "‚û§ $file:"
          head -20 "$file"
          echo "---"
        done
        
    - name: Clean previous builds
      run: find . -name "*.class" -type f -delete
      
    - name: Compile all Java files
      run: |
        echo "üî® COMPILANDO PROYECTO..."
        javac *.java
        if [ $? -eq 0 ]; then
          echo "‚úÖ Compilaci√≥n exitosa"
        else
          echo "‚ùå Error en compilaci√≥n"
          exit 1
        fi
        
    - name: Show compiled classes
      run: |
        echo "üì¶ ARCHIVOS .class GENERADOS:"
        echo "============================="
        ls -la *.class
        echo ""
        echo "üóÇÔ∏è Lista completa:"
        find . -name "*.class" -type f
        
    - name: Run ProduccionAeronaves
      run: |
        echo "üöÄ EJECUTANDO PROGRAMA PRINCIPAL"
        echo "================================="
        java ProduccionAeronaves
        EXIT_CODE=$?
        echo ""
        echo "üìä Programa finalizado con c√≥digo: $EXIT_CODE"
        if [ $EXIT_CODE -eq 0 ]; then
          echo "‚úÖ Ejecuci√≥n completada con √©xito"
        else
          echo "‚ùå Ocurri√≥ un error durante la ejecuci√≥n"
          exit $EXIT_CODE
        fi
