name: Java CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '11'

    - name: Debug - Show project structure
      run: |
        echo "=== Project structure ==="
        find . -name "*.java" -type f | sort
        echo ""
        echo "=== First few lines of main file ==="
        head -5 ProduccionAeronaves.java || echo "File not found"

    - name: Clean build directory
      run: |
        rm -rf out 2>/dev/null || true
        mkdir -p out

    - name: Compile with explicit path
      run: |
        echo "=== Compiling Java files ==="
        # Compila todos los archivos Java en el directorio actual
        javac -d out *.java 2>&1 | tee compile.log
        echo "Compilation exit code: $?"

    - name: Debug compiled structure
      run: |
        echo "=== Compiled classes structure ==="
        if [ -d "out" ]; then
          find out -type f -name "*.class" | sort
          echo ""
          echo "=== Package structure ==="
          ls -la out/ || echo "out directory exists but empty"
        else
          echo "out directory not found"
        fi

    - name: Check compilation log
      if: always()
      run: |
        echo "=== Compilation log ==="
        cat compile.log 2>/dev/null || echo "No compilation log"

    - name: Run main class (primer intento)
      run: |
        echo "=== Attempt 1: With package ==="
        java -cp out tarea2.ProduccionAeronaves 2>&1 || echo "Attempt 1 failed"

    - name: Run main class (segundo intento - sin paquete)
      run: |
        echo "=== Attempt 2: Without package (if no package declaration) ==="
        java -cp out ProduccionAeronaves 2>&1 || echo "Attempt 2 failed"
